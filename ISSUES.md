# AI Session Viewer é—®é¢˜æ€»ç»“

ç”Ÿæˆæ—¶é—´: 2026-01-15
èŒƒå›´: Claude Code + Codex ä¼šè¯æ”¯æŒ

---

## ğŸ”§ åç«¯é—®é¢˜ (Python Backend)

### P0 - ä¼šè¯è¿‡æ»¤é€»è¾‘é—®é¢˜
**ä¸¥é‡ç¨‹åº¦**: ğŸ”´ é«˜
**æ–‡ä»¶**: `session_viewer.py:536-578`
**é—®é¢˜æè¿°**:
- ä»æˆªå›¾çœ‹åˆ°ä¸€äº›ä¼šè¯æ ‡é¢˜æ˜¾ç¤ºä¸º "nh"ã€"ä½ å¥½"ã€"â”€â”€â”€â”€" ç­‰è¿‡çŸ­æˆ–æ— æ„ä¹‰çš„å†…å®¹
- `_is_user_manual_input()` æ–¹æ³•å¯èƒ½è¿‡åº¦è¿‡æ»¤äº†åˆæ³•çš„ç”¨æˆ·è¾“å…¥
- éœ€è¦æ›´æ™ºèƒ½çš„åˆ¤æ–­é€»è¾‘

**ä¿®å¤ä»»åŠ¡**:
1. æ£€æŸ¥å¹¶ä¼˜åŒ–ç³»ç»Ÿæ¶ˆæ¯è¿‡æ»¤è§„åˆ™
2. å¯¹äºè¿‡çŸ­çš„ä¼šè¯ï¼ˆ< 3ä¸ªå­—ç¬¦ï¼‰ï¼Œè€ƒè™‘ä½¿ç”¨åç»­æ¶ˆæ¯ä½œä¸ºæ ‡é¢˜
3. æ·»åŠ å•å…ƒæµ‹è¯•éªŒè¯è¿‡æ»¤é€»è¾‘
4. ç¡®ä¿ä¸­æ–‡ç®€çŸ­è¾“å…¥ä¸ä¼šè¢«é”™è¯¯è¿‡æ»¤

### P1 - ç´¢å¼•æ•°æ®åº“åŒæ­¥æœºåˆ¶
**ä¸¥é‡ç¨‹åº¦**: ğŸŸ¡ ä¸­
**æ–‡ä»¶**: `session_viewer.py` (SessionIndexer ç±»)
**é—®é¢˜æè¿°**:
- Mac App ä¾èµ–ç´¢å¼•æ•°æ®åº“ (`~/.cache/ai-session-viewer/index.db`)
- éœ€è¦ç”¨æˆ·æ‰‹åŠ¨è¿è¡Œ `aisv --build-index` æ¥æ›´æ–°ç´¢å¼•
- æ²¡æœ‰è‡ªåŠ¨åŒæ­¥æœºåˆ¶ï¼Œæ•°æ®å¯èƒ½è¿‡æœŸ

**ä¿®å¤ä»»åŠ¡**:
1. ä¼˜åŒ–å¢é‡ç´¢å¼•æ›´æ–°é€»è¾‘ï¼ˆå·²æœ‰ mtime æ£€æŸ¥ï¼‰
2. æ·»åŠ æ–‡ä»¶å˜æ›´æ£€æµ‹æœºåˆ¶
3. æä¾›æ›´æ¸…æ™°çš„ç´¢å¼•çŠ¶æ€æç¤º

### P2 - æ—¥æœŸæ—¶é—´å¤„ç†ä¼˜åŒ–
**ä¸¥é‡ç¨‹åº¦**: ğŸŸ¢ ä½
**æ–‡ä»¶**: `session_viewer.py:292-307`
**é—®é¢˜æè¿°**:
- æ—¶é—´æ ¼å¼åŒ–é€»è¾‘åˆ†æ•£
- æ—¶åŒºå¤„ç†éœ€è¦ç»Ÿä¸€

**ä¿®å¤ä»»åŠ¡**:
1. ç»Ÿä¸€ä½¿ç”¨ UTC å­˜å‚¨ï¼Œæœ¬åœ°æ—¶åŒºæ˜¾ç¤º
2. ç®€åŒ– `normalize_datetime()` å’Œ `format_datetime()` é€»è¾‘

---

## ğŸ“± å‰ç«¯é—®é¢˜ (Mac App - SwiftUI)

### P0 - æ–‡æœ¬æˆªæ–­æ˜¾ç¤ºé”™è¯¯
**ä¸¥é‡ç¨‹åº¦**: ğŸ”´ é«˜
**æ–‡ä»¶**: `SessionRowView.swift:12`
**é—®é¢˜æè¿°**:
- **ä»æˆªå›¾çœ‹åˆ°"å·¥å…·"åˆ—æ˜¾ç¤ºä¸º "Clau de Co de"ï¼Œåº”è¯¥æ˜¯ "Claude Code"**
- æ–‡å­—è¢«é”™è¯¯æˆªæ–­ï¼Œå½±å“å¯è¯»æ€§
- å¯èƒ½æ˜¯åˆ—å®½é™åˆ¶æˆ– SwiftUI å¸ƒå±€é—®é¢˜

**ä¿®å¤å»ºè®®**:
```swift
// SessionRowView.swift
HStack(spacing: 8) {
    Text(session.toolDisplayName)
        .fixedSize(horizontal: true, vertical: false)
        .lineLimit(1)
    // ...
}
```

### P0 - æ—¶é—´æ ¼å¼æ˜¾ç¤ºé—®é¢˜
**ä¸¥é‡ç¨‹åº¦**: ğŸ”´ é«˜
**æ–‡ä»¶**: `Models.swift:106-114`
**é—®é¢˜æè¿°**:
- æˆªå›¾ä¸­æ—¶é—´æ˜¾ç¤ºä¸º `2026-01-15T01:26:23.217000`ï¼ˆåŸå§‹æ ¼å¼ï¼‰
- åº”è¯¥æ˜¾ç¤ºä¸ºç”¨æˆ·å‹å¥½çš„æ ¼å¼: `2026-01-15 01:26`
- `DateFormats.displayString()` æœªæ­£ç¡®å¤„ç†å¸¦æ¯«ç§’çš„æ—¶é—´æˆ³

**ä¿®å¤å»ºè®®**:
```swift
static func displayString(_ value: String) -> String {
    if value.isEmpty { return "æœªçŸ¥" }

    // å¤„ç†å¸¦æ¯«ç§’çš„ ISO æ ¼å¼: "2026-01-15T01:26:23.217000"
    let cleanValue = value.components(separatedBy: ".").first ?? value

    if let date = isoFormatter.date(from: cleanValue) {
        return displayFormatter.string(from: date)
    }
    return "æœªçŸ¥"
}
```

### P1 - ä¼šè¯åˆ—è¡¨ UI ä¼˜åŒ–
**ä¸¥é‡ç¨‹åº¦**: ğŸŸ¡ ä¸­
**æ–‡ä»¶**: `SessionRowView.swift`
**é—®é¢˜æè¿°**:
- é¡¹ç›®è·¯å¾„è¿‡é•¿æ—¶æ˜¾ç¤ºä¸å®Œæ•´
- ç¼ºå°‘ tooltip æç¤ºå®Œæ•´è·¯å¾„
- ä¿¡æ¯å±‚æ¬¡ä¸å¤Ÿæ¸…æ™°

**ä¿®å¤å»ºè®®**:
```swift
VStack(alignment: .leading, spacing: 6) {
    // æ ‡é¢˜
    Text(session.firstMessage.isEmpty ? "(æ— æ ‡é¢˜)" : session.firstMessage)
        .lineLimit(2)
        .font(.headline)

    // å…ƒæ•°æ®
    HStack(spacing: 12) {
        Label(session.toolDisplayName, systemImage: "hammer.fill")
        Label(DateFormats.displayString(session.lastTime), systemImage: "clock")
        Label("\(session.messageCount) æ¡", systemImage: "bubble.left")
    }
    .font(.caption)
    .foregroundColor(.secondary)

    // é¡¹ç›®è·¯å¾„ - æ”¯æŒä¸­é—´æˆªæ–­å’Œ tooltip
    Text(session.projectPath)
        .font(.caption2)
        .foregroundColor(.tertiary)
        .lineLimit(1)
        .truncationMode(.middle)
        .help(session.projectPath)
}
.padding(.vertical, 4)
```

### P1 - åŠ è½½çŠ¶æ€ä¸ç©ºçŠ¶æ€
**ä¸¥é‡ç¨‹åº¦**: ğŸŸ¡ ä¸­
**æ–‡ä»¶**: `SessionStore.swift` + ä¸»è§†å›¾
**é—®é¢˜æè¿°**:
- è™½ç„¶æœ‰ `isLoading` å’Œ `statusMessage` çŠ¶æ€
- ä½†ä¸»è§†å›¾å¯èƒ½æ²¡æœ‰å……åˆ†å±•ç¤ºè¿™äº›çŠ¶æ€
- ç¼ºå°‘å‹å¥½çš„ç©ºçŠ¶æ€æç¤º

**ä¿®å¤å»ºè®®**:
- æ·»åŠ  `ProgressView` æ˜¾ç¤ºåŠ è½½çŠ¶æ€
- æ·»åŠ ç©ºçŠ¶æ€è§†å›¾ï¼ˆæ— ä¼šè¯æ—¶çš„æç¤ºï¼‰
- æ˜¾ç¤º `statusMessage`ï¼ˆå¦‚"ç´¢å¼•æ•°æ®åº“ä¸å­˜åœ¨"ï¼‰

---

## ğŸ“ ä»»åŠ¡åˆ†é…

### ğŸ”§ åç«¯ä»»åŠ¡ â†’ Codex
**æ–‡ä»¶**: `session_viewer.py`

1. **ä¼˜åŒ–ä¼šè¯è¿‡æ»¤é€»è¾‘** (P0)
   - ä¿®å¤ `_is_user_manual_input()` æ–¹æ³•
   - å¯¹è¿‡çŸ­æ ‡é¢˜ä½¿ç”¨åç»­æ¶ˆæ¯
   - æ·»åŠ å•å…ƒæµ‹è¯•

2. **æ”¹è¿›ç´¢å¼•æ›´æ–°æœºåˆ¶** (P1)
   - ä¼˜åŒ–å¢é‡ç´¢å¼•é€»è¾‘
   - æ·»åŠ çŠ¶æ€æ£€æŸ¥

3. **ç»Ÿä¸€æ—¥æœŸæ—¶é—´å¤„ç†** (P2)
   - ç®€åŒ–æ—¶é—´æ ¼å¼åŒ–ä»£ç 
   - ç¡®ä¿æ—¶åŒºä¸€è‡´æ€§

### ğŸ“± å‰ç«¯ä»»åŠ¡ â†’ Gemini
**æ–‡ä»¶**: `mac-app/Sources/AISessionViewer/`

1. **ä¿®å¤æ–‡æœ¬æˆªæ–­é—®é¢˜** (P0)
   - `SessionRowView.swift`: ä¿®å¤å·¥å…·åæ˜¾ç¤º
   - ç¡®ä¿ "Claude Code" å®Œæ•´æ˜¾ç¤º

2. **ä¿®å¤æ—¶é—´æ ¼å¼æ˜¾ç¤º** (P0)
   - `Models.swift`: ä¿®å¤ `DateFormats.displayString()`
   - æ­£ç¡®è§£æå¸¦æ¯«ç§’çš„æ—¶é—´æˆ³

3. **ä¼˜åŒ– UI å¸ƒå±€** (P1)
   - `SessionRowView.swift`: æ”¹è¿›å¸ƒå±€å’Œä¿¡æ¯å±‚æ¬¡
   - æ·»åŠ  tooltip æ”¯æŒ
   - ä½¿ç”¨ SF Symbols å›¾æ ‡

4. **æ”¹è¿›çŠ¶æ€æ˜¾ç¤º** (P1)
   - æ·»åŠ åŠ è½½çŠ¶æ€è§†å›¾
   - æ·»åŠ ç©ºçŠ¶æ€è§†å›¾
   - æ˜¾ç¤ºé”™è¯¯æç¤º

---

## âœ… éªŒæ”¶æ ‡å‡†

### åç«¯
- [ ] ä¼šè¯æ ‡é¢˜ä¸å†æ˜¾ç¤º "nh"ã€"â”€â”€â”€â”€" ç­‰æ— æ„ä¹‰å†…å®¹
- [ ] è¿‡çŸ­ä¼šè¯èƒ½æ­£ç¡®æå–åç»­æ¶ˆæ¯ä½œä¸ºæ ‡é¢˜
- [ ] ç´¢å¼•æ›´æ–°æœºåˆ¶è¿è¡Œæ­£å¸¸
- [ ] æ—¶é—´å¤„ç†ç»Ÿä¸€ä¸”æ­£ç¡®

### å‰ç«¯
- [ ] "Claude Code" å’Œ "Codex" å®Œæ•´æ˜¾ç¤ºï¼Œæ— æˆªæ–­
- [ ] æ—¶é—´æ ¼å¼æ˜¾ç¤ºä¸º `2026-01-15 01:26`ï¼Œæ¸…æ™°æ˜“è¯»
- [ ] é¡¹ç›®è·¯å¾„è¿‡é•¿æ—¶èƒ½ä¸­é—´æˆªæ–­å¹¶æ˜¾ç¤º tooltip
- [ ] æœ‰æ˜ç¡®çš„åŠ è½½ã€ç©ºçŠ¶æ€ã€é”™è¯¯çŠ¶æ€æç¤º
- [ ] UI å¸ƒå±€ç¾è§‚ï¼Œä¿¡æ¯å±‚æ¬¡æ¸…æ™°

---

**ç”Ÿæˆè€…**: Claude Sonnet 4.5
**é¡¹ç›®**: AI Session Viewer
**ç‰ˆæœ¬**: 1.0
